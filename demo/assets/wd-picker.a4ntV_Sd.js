var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(l,a,s)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[a]=s,n=(e,l)=>{for(var a in l||(l={}))o.call(l,a)&&r(e,a,l[a]);if(s)for(var a of s(l))t.call(l,a)&&r(e,a,l[a]);return e},u=(e,s)=>l(e,a(s));import{d as i,r as c,c as d,C as m,J as p,y as v,a6 as f,ar as g,M as b,B as y,aC as _,aK as h,aO as k,b as w,g as C,w as V,h as S,i as x,D as O,z as $,E as j,q as K,m as F,F as I,j as T,t as z,l as P,K as q,ad as A}from"./index-Ddr6X_C9.js";import{b as B,c as D,f as M,m as L,a as W,w as E,_ as H}from"./base64.DGXTDNor.js";import{e as R,u as U,F as G,a as J}from"./wd-loading.CTKNgZO5.js";import{f as N,w as X}from"./wd-picker-view.jLRqTqVI.js";import{u as Q}from"./useTranslate.zeM_cXdJ.js";const Y=u(n({},B),{customLabelClass:W(""),customValueClass:W(""),customViewClass:W(""),label:String,placeholder:String,disabled:D(!1),readonly:D(!1),loading:D(!1),loadingColor:W("#4D80F0"),title:String,cancelButtonText:String,confirmButtonText:String,required:D(!1),size:String,labelWidth:String,useDefaultSlot:D(!1),useLabelSlot:D(!1),error:D(!1),alignRight:D(!1),beforeConfirm:Function,closeOnClickModal:D(!0),safeAreaInsetBottom:D(!0),ellipsis:D(!1),columnsHeight:L(217),valueKey:W("value"),labelKey:W("label"),modelValue:{type:[String,Number,Array],default:""},columns:{type:Array,default:()=>[]},columnChange:Function,displayFormat:Function,zIndex:L(15),prop:String,rules:M(),immediateChange:D(!1),clearable:D(!1)}),Z=H(i(u(n({},{name:"wd-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),{props:Y,emits:["confirm","open","cancel","clear","update:modelValue"],setup(e,{expose:l,emit:a}){const{translate:s}=Q("picker"),o=e,t=a,r=c(null),n=R(),u=c(!1),i=c(!1),B=c(""),D=c(""),M=c([]),L=c([]),W=c(!1),H=c(!1),Y=d((()=>o.loading||u.value));m((()=>o.displayFormat),(e=>{e&&!A(e)&&console.error("The type of displayFormat must be Function"),r.value&&0!==r.value.getSelectedIndex().length&&se(o.modelValue)}),{immediate:!0,deep:!0}),m((()=>o.modelValue),(e=>{D.value=e,se(e)}),{deep:!0,immediate:!0}),m((()=>o.columns),(e=>{M.value=g(e),L.value=g(e),0===e.length?(D.value=b(o.modelValue)?[]:"",B.value=""):se(o.modelValue)}),{deep:!0,immediate:!0}),m((()=>o.columnChange),(e=>{e&&!A(e)&&console.error("The type of columnChange must be Function")}),{deep:!0,immediate:!0});const{parent:Z}=U(G),ee=d((()=>Z&&o.prop&&Z.errorMessages&&Z.errorMessages[o.prop]?Z.errorMessages[o.prop]:"")),le=d((()=>{let e=!1;if(Z&&Z.props.rules){const l=Z.props.rules;for(const a in l)Object.prototype.hasOwnProperty.call(l,a)&&a===o.prop&&Array.isArray(l[a])&&(e=l[a].some((e=>e.required)))}return o.required||o.rules.some((e=>e.required))||e})),{proxy:ae}=p();function se(e){b(e)&&e.length>0||y(e)&&!b(e)&&""!==e?r.value?_((()=>{ie(r.value.getSelects())})):ie(function(e){const l=N(o.columns,o.valueKey,o.labelKey);if(0===o.columns.length)return;if(""===e||!y(e)||b(e)&&0===e.length)return;const a=h(e);if(-1===["string","number","boolean","array"].indexOf(a))return[];e=b(e)?e:[e],e=e.slice(0,l.length),0===e.length&&(e=l.map((()=>0)));let s=[];e.forEach(((e,a)=>{let t=l[a].findIndex((l=>l[o.valueKey].toString()===e.toString()));t=-1===t?0:t,s.push(t)}));const t=s.map(((e,a)=>l[a][e]));if(1===t.length)return t[0];return t}(e)):B.value=""}function oe(){o.disabled||o.readonly||(t("open"),i.value=!0,D.value=o.modelValue,M.value=L.value)}function te(){i.value=!1,t("cancel");let e=setTimeout((()=>{clearTimeout(e),y(r.value)&&r.value.resetColumns(L.value)}),300)}function re(){if(Y.value)return;if(W.value)return void(H.value=!0);const{beforeConfirm:e}=o;e&&A(e)?e(D.value,(e=>{e&&ne()}),ae.$.exposed):ne()}function ne(){if(Y.value||o.disabled)return void(i.value=!1);const e=r.value.getSelects(),l=r.value.getValues(),a=r.value.getColumnsData();i.value=!1,L.value=g(a),t("update:modelValue",l),ie(e),t("confirm",{value:l,selectedItems:e})}function ue({value:e}){D.value=e}function ie(e){if(b(e)&&!e.length||!e)return;const{valueKey:l,labelKey:a}=o;B.value=(o.displayFormat||k)(e,{valueKey:l,labelKey:a})}function ce(){}function de(){W.value=!0}function me(){W.value=!1,H.value&&(H.value=!1,re())}v((()=>{se(o.modelValue)})),f((()=>{M.value=g(o.columns),L.value=g(o.columns)}));const pe=d((()=>o.clearable&&!o.disabled&&!o.readonly&&B.value.length));function ve(){const e=b(D.value)?[]:"";t("update:modelValue",e),t("clear")}const fe=d((()=>!o.disabled&&!o.readonly&&!pe.value));return l({close:function(){te()},open:function(){oe()},setLoading:function(e){u.value=e}}),(e,l)=>{const a=x;return C(),w(a,{class:K(`wd-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${P(n).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`),style:j(e.customStyle)},{default:V((()=>[S(a,{class:"wd-picker__field",onClick:oe},{default:V((()=>[e.useDefaultSlot?O(e.$slots,"default",{key:0},void 0,!0):(C(),w(a,{key:1,class:"wd-picker__cell"},{default:V((()=>[e.label||e.useLabelSlot?(C(),w(a,{key:0,class:K(`wd-picker__label ${e.customLabelClass}  ${le.value?"is-required":""}`),style:j(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")},{default:V((()=>[e.label?(C(),F(I,{key:0},[T(z(e.label),1)],64)):O(e.$slots,"label",{key:1},void 0,!0)])),_:3},8,["class","style"])):$("",!0),S(a,{class:"wd-picker__body"},{default:V((()=>[S(a,{class:"wd-picker__value-wraper"},{default:V((()=>[S(a,{class:K(`wd-picker__value ${e.ellipsis&&"is-ellipsis"} ${e.customValueClass} ${B.value?"":"wd-picker__placeholder"}`)},{default:V((()=>[T(z(B.value?B.value:e.placeholder||P(s)("placeholder")),1)])),_:1},8,["class"]),fe.value?(C(),w(E,{key:0,"custom-class":"wd-picker__arrow",name:"arrow-right"})):pe.value?(C(),w(a,{key:1,onClick:q(ve,["stop"])},{default:V((()=>[S(E,{"custom-class":"wd-picker__clear",name:"error-fill"})])),_:1})):$("",!0)])),_:1}),ee.value?(C(),w(a,{key:0,class:"wd-picker__error-message"},{default:V((()=>[T(z(ee.value),1)])),_:1})):$("",!0)])),_:1})])),_:3}))])),_:3}),S(J,{modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=e=>i.value=e),position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"z-index":e.zIndex,"safe-area-inset-bottom":e.safeAreaInsetBottom,onClose:te,"custom-class":"wd-picker__popup"},{default:V((()=>[S(a,{class:"wd-picker__wraper"},{default:V((()=>[S(a,{class:"wd-picker__toolbar",onTouchmove:ce},{default:V((()=>[S(a,{class:"wd-picker__action wd-picker__action--cancel",onClick:te},{default:V((()=>[T(z(e.cancelButtonText||P(s)("cancel")),1)])),_:1}),e.title?(C(),w(a,{key:0,class:"wd-picker__title"},{default:V((()=>[T(z(e.title),1)])),_:1})):$("",!0),S(a,{class:K("wd-picker__action "+(Y.value?"is-loading":"")),onClick:re},{default:V((()=>[T(z(e.confirmButtonText||P(s)("done")),1)])),_:1},8,["class"])])),_:1}),S(X,{ref_key:"pickerViewWd",ref:r,"custom-class":e.customViewClass,modelValue:D.value,"onUpdate:modelValue":l[0]||(l[0]=e=>D.value=e),columns:M.value,loading:Y.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,"immediate-change":e.immediateChange,onChange:ue,onPickstart:de,onPickend:me,"column-change":e.columnChange},null,8,["custom-class","modelValue","columns","loading","loading-color","columns-height","value-key","label-key","immediate-change","column-change"])])),_:1})])),_:1},8,["modelValue","close-on-click-modal","z-index","safe-area-inset-bottom"])])),_:3},8,["class","style"])}}})),[["__scopeId","data-v-1af57746"]]);export{Z as _};
