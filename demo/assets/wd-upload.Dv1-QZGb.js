var e=Object.defineProperty,s=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,i=(s,o,l)=>o in s?e(s,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[o]=l,r=(e,s)=>{for(var o in s||(s={}))a.call(s,o)&&i(e,o,s[o]);if(l)for(var o of l(s))t.call(s,o)&&i(e,o,s[o]);return e},n=(e,l)=>s(e,o(l));import{d as u,r as c,al as d,b as p,z as f,g as m,w as v,h as _,i as y,K as w,aU as b,E as h,q as g,aC as k,c as C,C as x,m as P,F as L,n as T,D as I,p as D,j as F,t as z,k as j,l as K,B as O,ar as S,aV as E,aW as U,aX as M,x as N,I as $,a0 as A,ac as G,as as R,ad as q}from"./index-Ddr6X_C9.js";import{b as H,w as B,_ as V}from"./base64.DGXTDNor.js";import{f as W,b as X}from"./wd-loading.CTKNgZO5.js";import{u as J}from"./useTranslate.zeM_cXdJ.js";import{a as Q,u as Y}from"./types.BMm8I42B.js";const Z=r({},H),ee=V(u(n(r({},{name:"wd-video-preview",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}}),{props:Z,setup(e,{expose:s}){const o=c(!1),l=d({url:"",poster:"",title:""});function a(){o.value=!1,k((()=>{l.url="",l.poster="",l.title=""}))}return W((()=>o.value)),s({open:function(e){o.value=!0,l.url=e.url,l.poster=e.poster,l.title=e.title},close:a}),(e,s)=>{const t=b,i=y;return o.value?(m(),p(i,{key:0,class:g(`wd-video-preview ${e.customClass}`),style:h(e.customStyle),onClick:a},{default:v((()=>[_(i,{class:"wd-video-preview__video",onClick:s[0]||(s[0]=w((()=>{}),["stop"]))},{default:v((()=>[l.url?(m(),p(t,{key:0,class:"wd-video-preview__video",controls:!0,poster:l.poster,title:l.title,"play-btn-position":"center",enableNative:!0,src:l.url,"enable-progress-gesture":!1},null,8,["poster","title","src"])):f("",!0)])),_:1}),_(B,{name:"close","custom-class":"wd-video-preview__close",onClick:a})])),_:1},8,["class","style"])):f("",!0)}}})),[["__scopeId","data-v-dfc3ea0a"]]),se=V(u(n(r({},{name:"wd-upload",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}}),{props:Q,emits:["fail","change","success","progress","oversize","chooseerror","remove","update:fileList"],setup(e,{expose:s,emit:o}){const l=e,a=o;s({submit:()=>Q(),abort:()=>k()});const{translate:t}=J("upload"),i=c([]),u=C((()=>!l.limit||i.value.length<l.limit)),d=c(),{startUpload:w,abort:k,chooseFile:H,UPLOAD_STATUS:V}=Y();function W(){a("update:fileList",i.value)}function Q(){const{buildFormData:e,formData:s={},statusKey:o}=l,{action:a,name:t,header:r={},accept:n,successStatus:u,uploadMethod:c}=l,d=O(u)?u:200;for(const l of i.value)l[o]===V.PENDING&&(e?e({file:l,formData:s,resolve:e=>{e&&w(l,{action:a,header:r,name:t,formData:e,fileType:n,statusCode:d,statusKey:o,uploadMethod:c,onSuccess:le,onError:oe,onProgress:ae})}}):w(l,{action:a,header:r,name:t,formData:s,fileType:n,statusCode:d,statusKey:o,uploadMethod:c,onSuccess:le,onError:oe,onProgress:ae}))}function Z(e){return new Promise(((s,o)=>{A({src:e,success:e=>{s(e)},fail:e=>{o(e)}})}))}function se(e,s){const{statusKey:o}=l,a={uid:G.id++,name:e.name||"",thumb:e.thumb||"",[o]:"pending",size:e.size||0,url:e.path,percent:0};"number"==typeof s?i.value.splice(s,1,a):i.value.push(a),l.autoUpload&&Q()}function oe(e,s,o){const{statusKey:t}=l,r=i.value.findIndex((e=>e.uid===s.uid));r>-1&&(i.value[r][t]="fail",i.value[r].error=e.message,i.value[r].response=e,a("fail",{error:e,file:s,formData:o}),W())}function le(e,s,o){const{statusKey:t}=l,r=i.value.findIndex((e=>e.uid===s.uid));r>-1&&(i.value[r][t]="success",i.value[r].response=e.data,a("change",{fileList:i.value}),a("success",{file:s,fileList:i.value,formData:o}),W())}function ae(e,s){const o=i.value.findIndex((e=>e.uid===s.uid));o>-1&&(i.value[o].percent=e.progress,a("progress",{response:e,file:s}))}function te(e){const{multiple:s,maxSize:o,accept:t,sizeType:r,limit:n,sourceType:u,compressed:c,maxDuration:d,camera:p,beforeUpload:f,extension:m}=l;H({multiple:s,sizeType:r,sourceType:u,maxCount:n?n-i.value.length:9,accept:t,compressed:c,maxDuration:d,camera:p,extension:m}).then((l=>{let t=l;s||(t=t.slice(0,1));const r=s=>{return l=this,t=null,i=function*(){for(let l=0;l<s.length;l++){const t=s[l];if("image"===t.type&&!t.size){const e=yield Z(t.path);t.size=e.width*e.height}Number(t.size)<=o?se(t,e):a("oversize",{file:t})}},new Promise(((e,s)=>{var o=e=>{try{r(i.next(e))}catch(o){s(o)}},a=e=>{try{r(i.throw(e))}catch(o){s(o)}},r=s=>s.done?e(s.value):Promise.resolve(s.value).then(o,a);r((i=i.apply(l,t)).next())}));var l,t,i};f?f({files:t,fileList:i.value,resolve:e=>{e&&r(t)}}):r(t)})).catch((e=>{a("chooseerror",{error:e})}))}function ie(e){if(l.disabled)return;const{beforeChoose:s}=l;s?s({fileList:i.value,resolve:s=>{s&&te(e)}}):te(e)}function re(e){i.value.splice(i.value.findIndex((s=>s.uid===e.uid)),1),a("change",{fileList:i.value}),a("remove",{file:e}),W()}function ne(e){M({filePath:e.url,showMenu:!0})}function ue(e,s){const{onPreviewFail:o}=l;N({urls:s,current:s[e],fail(){o?o({index:e,imgList:s}):$({title:"预览图片失败",icon:"none"})}})}function ce(e,s){var o;const{onPreviewFail:a}=l;null==(o=d.value)||o.open({url:s[e].url,poster:s[e].thumb,title:s[e].name})}function de(e){const{beforePreview:s,reupload:o}=l,a=S(i.value),t=a.findIndex((s=>s.url===e.url)),r=a.filter((e=>pe(e))),n=r.findIndex((s=>s.url===e.url));o?ie(t):s?s({file:e,index:t,imgList:[],fileList:a,resolve:e=>{e&&ce(n,r)}}):ce(n,r)}function pe(e){return e.name&&E(e.name)||E(e.url)}function fe(e){return e.name&&U(e.name)||U(e.url)}return x((()=>l.fileList),(e=>{const{statusKey:s}=l;if(R(e,i.value))return;const o=e.map((e=>(e[s]=e[s]||"success",e.response=e.response||"",n(r({},e),{uid:G.id++}))));i.value=o}),{deep:!0,immediate:!0}),x((()=>l.limit),(e=>{e&&e<i.value.length&&console.error("[wot-design]Error: props limit must less than fileList.length")}),{deep:!0,immediate:!0}),x((()=>l.beforePreview),(e=>{e&&!q(e)&&console.error("The type of beforePreview must be Function")}),{deep:!0,immediate:!0}),x((()=>l.onPreviewFail),(e=>{e&&!q(e)&&console.error("The type of onPreviewFail must be Function")}),{deep:!0,immediate:!0}),x((()=>l.beforeRemove),(e=>{e&&!q(e)&&console.error("The type of beforeRemove must be Function")}),{deep:!0,immediate:!0}),x((()=>l.beforeUpload),(e=>{e&&!q(e)&&console.error("The type of beforeUpload must be Function")}),{deep:!0,immediate:!0}),x((()=>l.beforeChoose),(e=>{e&&!q(e)&&console.error("The type of beforeChoose must be Function")}),{deep:!0,immediate:!0}),x((()=>l.buildFormData),(e=>{e&&!q(e)&&console.error("The type of buildFormData must be Function")}),{deep:!0,immediate:!0}),(e,s)=>{const o=D,a=y,r=b,n=j;return m(),P(L,null,[_(a,{class:g(["wd-upload",e.customClass]),style:h(e.customStyle)},{default:v((()=>[(m(!0),P(L,null,T(i.value,((s,u)=>(m(),p(a,{class:g(["wd-upload__preview",e.customPreviewClass]),key:u},{default:v((()=>[_(a,{class:"wd-upload__status-content"},{default:v((()=>[fe(s)?(m(),p(o,{key:0,src:s.url,mode:e.imageMode,class:"wd-upload__picture",onClick:e=>function(e){const{beforePreview:s,reupload:o}=l,a=S(i.value),t=a.findIndex((s=>s.url===e.url)),r=a.filter((e=>fe(e))).map((e=>e.url)),n=r.findIndex((s=>s===e.url));o?ie(t):s?s({file:e,index:t,fileList:a,imgList:r,resolve:e=>{e&&ue(n,r)}}):ue(n,r)}(s)},null,8,["src","mode","onClick"])):pe(s)?(m(),P(L,{key:1},[s.thumb?(m(),p(a,{key:0,class:"wd-upload__video",onClick:e=>de(s)},{default:v((()=>[_(o,{src:s.thumb,mode:e.imageMode,class:"wd-upload__picture"},null,8,["src","mode"]),_(B,{name:"play-circle-filled","custom-class":"wd-upload__video-paly"})])),_:2},1032,["onClick"])):(m(),p(a,{key:1,class:"wd-upload__video",onClick:e=>de(s)},{default:v((()=>[_(r,{src:s.url,title:s.name||"视频"+u,"object-fit":"contain",controls:!1,poster:s.thumb,autoplay:!1,"show-center-play-btn":!1,"show-fullscreen-btn":!1,"show-play-btn":!1,"show-loading":!1,"show-progress":!1,"show-mute-btn":!1,"enable-progress-gesture":!1,enableNative:!0,class:"wd-upload__video"},null,8,["src","title","poster"]),_(B,{name:"play-circle-filled","custom-class":"wd-upload__video-paly"})])),_:2},1032,["onClick"]))],64)):(m(),p(a,{key:2,class:"wd-upload__file",onClick:e=>function(e){const{beforePreview:s,reupload:o}=l,a=S(i.value),t=a.findIndex((s=>s.url===e.url));o?ie(t):s?s({file:e,index:t,imgList:[],fileList:a,resolve:s=>{s&&ne(e)}}):ne(e)}(s)},{default:v((()=>[_(B,{name:"file","custom-class":"wd-upload__file-icon"}),_(a,{class:"wd-upload__file-name"},{default:v((()=>[F(z(s.name||s.url),1)])),_:2},1024)])),_:2},1032,["onClick"]))])),_:2},1024),"success"!==s[l.statusKey]?(m(),p(a,{key:0,class:"wd-upload__mask wd-upload__status-content"},{default:v((()=>["loading"===s[l.statusKey]?(m(),p(a,{key:0,class:"wd-upload__status-content"},{default:v((()=>[_(X,{type:e.loadingType,size:e.loadingSize,color:e.loadingColor},null,8,["type","size","color"]),_(n,{class:"wd-upload__progress-txt"},{default:v((()=>[F(z(s.percent)+"%",1)])),_:2},1024)])),_:2},1024)):f("",!0),"fail"===s[l.statusKey]?(m(),p(a,{key:1,class:"wd-upload__status-content"},{default:v((()=>[_(B,{name:"close-outline","custom-class":"wd-upload__icon"}),_(n,{class:"wd-upload__progress-txt"},{default:v((()=>[F(z(s.error||K(t)("error")),1)])),_:2},1024)])),_:2},1024)):f("",!0)])),_:2},1024)):f("",!0),"loading"===s[l.statusKey]||e.disabled?f("",!0):(m(),p(B,{key:1,name:"error-fill","custom-class":"wd-upload__close",onClick:e=>function(e){const{beforeRemove:s}=l,o=e,a=i.value[o];s?s({file:a,index:o,fileList:i.value,resolve:e=>{e&&re(a)}}):re(a)}(u)},null,8,["onClick"])),e.$slots["preview-cover"]?I(e.$slots,"preview-cover",{key:2,file:s,index:u},void 0,!0):f("",!0)])),_:2},1032,["class"])))),128)),u.value?(m(),P(L,{key:0},[e.$slots.default?(m(),p(a,{key:0,class:g(["wd-upload__evoke-slot",e.customEvokeClass]),onClick:ie},{default:v((()=>[I(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])):(m(),p(a,{key:1,onClick:ie,class:g(["wd-upload__evoke",e.disabled?"is-disabled":"",e.customEvokeClass])},{default:v((()=>[_(B,{class:"wd-upload__evoke-icon",name:"fill-camera"}),e.limit&&e.showLimitNum?(m(),p(a,{key:0,class:"wd-upload__evoke-num"},{default:v((()=>[F("（"+z(i.value.length)+"/"+z(e.limit)+"）",1)])),_:1})):f("",!0)])),_:1},8,["class"]))],64)):f("",!0)])),_:3},8,["class","style"]),_(ee,{ref_key:"videoPreview",ref:d},null,512)],64)}}})),[["__scopeId","data-v-1223bb16"]]);export{se as _};
