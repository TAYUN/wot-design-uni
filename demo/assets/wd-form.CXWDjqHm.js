var e=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,p=(s,r,o)=>r in s?e(s,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[r]=o,n=(e,s)=>{var r={};for(var p in e)a.call(e,p)&&s.indexOf(p)<0&&(r[p]=e[p]);if(null!=e&&o)for(var p of o(e))s.indexOf(p)<0&&t.call(e,p)&&(r[p]=e[p]);return r};import{d as l,al as i,C as c,b as f,g as m,w as u,D as d,z as g,E as h,q as y,M as b,B as v,ap as O,a8 as w,af as j,ar as x,i as P}from"./index-Ddr6X_C9.js";import{a as E,b as k}from"./page-wraper.CYTeNmK-.js";import{u as C}from"./useChildren.Ckm0hsG6.js";import{g as _,F as q}from"./wd-loading.CTKNgZO5.js";import{_ as I}from"./base64.DGXTDNor.js";const T=l((B=((e,s)=>{for(var r in s||(s={}))a.call(s,r)&&p(e,r,s[r]);if(o)for(var r of o(s))t.call(s,r)&&p(e,r,s[r]);return e})({},{name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"}}),D={props:_,setup(e,{expose:s}){const{show:r}=E("wd-form-toast"),o=e,{children:a,linkChildren:t}=C(q);let p=i({});function l(e){e?p[e]="":Object.keys(p).forEach((e=>{p[e]=""}))}return t({props:o,errorMessages:p}),c((()=>o.model),(()=>{o.resetOnChange&&l()}),{immediate:!0,deep:!0}),s({validate:function(e){return s=this,t=null,i=function*(){const s=[];let t=!0;const i=[],c=function(){const e=x(o.rules),s=a.map((e=>e.prop));return Object.keys(e).forEach((r=>{s.includes(r)||delete e[r]})),a.forEach((s=>{v(s.prop)&&v(s.rules)&&s.rules.length&&(e[s.prop]?e[s.prop]=[...e[s.prop],...s.rules]:e[s.prop]=s.rules)})),e}(),f=b(e)?e:v(e)?[e]:[],m=f.length>0?f.reduce(((e,s)=>(c[s]&&(e[s]=c[s]),e)),{}):c;for(const e in m){const r=m[e],a=O(o.model,e);if(r&&r.length>0)for(const o of r){if(o.required&&(!v(a)||""===a)){s.push({prop:e,message:o.message}),t=!1;break}if(o.pattern&&!o.pattern.test(a)){s.push({prop:e,message:o.message}),t=!1;break}const r=o,{validator:p}=r,l=n(r,["validator"]);if(p){const r=p(a,l);w(r)?i.push(r.then((r=>{"string"==typeof r?(s.push({prop:e,message:r}),t=!1):"boolean"!=typeof r||r||(s.push({prop:e,message:o.message}),t=!1)})).catch((r=>{const a=v(r)?j(r)?r:r.message||o.message:o.message;s.push({prop:e,message:a}),t=!1}))):r||(s.push({prop:e,message:o.message}),t=!1)}}}return yield Promise.all(i),function(e){const s=a.map((e=>e.prop)).filter(Boolean),t=e.filter((e=>e.message&&s.includes(e.prop)));t.length&&(t.sort(((e,r)=>s.indexOf(e.prop)-s.indexOf(r.prop))),"toast"===o.errorType?r(t[0].message):"message"===o.errorType&&t.forEach((e=>{p[e.prop]=e.message})))}(s),t&&(f.length?f.forEach(l):l()),{valid:t,errors:s}},new Promise(((e,r)=>{var o=e=>{try{p(i.next(e))}catch(s){r(s)}},a=e=>{try{p(i.throw(e))}catch(s){r(s)}},p=s=>s.done?e(s.value):Promise.resolve(s.value).then(o,a);p((i=i.apply(s,t)).next())}));var s,t,i},reset:function(){l()}}),(e,s)=>{const r=P;return m(),f(r,{class:y(`wd-form ${e.customClass}`),style:h(e.customStyle)},{default:u((()=>[d(e.$slots,"default",{},void 0,!0),"toast"===o.errorType?(m(),f(k,{key:0,selector:"wd-form-toast"})):g("",!0)])),_:3},8,["class","style"])}}},s(B,r(D))));var B,D;const M=I(T,[["__scopeId","data-v-977d4bc0"]]);export{M as _};
